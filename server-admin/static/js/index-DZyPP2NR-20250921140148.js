import{r as b,B as $,aY as z,l as p,q as t,aZ as w,p as e,k as o,X as i,v as k,a_ as S,a$ as A,b0 as f,a1 as R,b1 as q,z as B,aX as N,j as U,b2 as O,F as L,d as F,b3 as X,b4 as E,M as H,b5 as J,y as Y}from"./@ant-design/icons-vue-SdefuLng-20250921140148.js";import{u as T,a as Z,M as K,b as C}from"./index-DqxiXOmF-20250921140148.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U-20250921140148.js";import"./dayjs-B73STPP_-20250921140148.js";import"./lodash-C9rdhAyu-20250921140148.js";import"./perfect-scrollbar-3J8fptrv-20250921140148.js";import"./pinia-BhevRhNK-20250921140148.js";const Q={class:"top-nav"},W={class:"user-section"},ee={class:"username"},te={__name:"index",props:{activeTab:{type:String,required:!0}},emits:["switch-tab"],setup(G,{emit:I}){const x=Z(),d=I,_=b({}),M=()=>{_.value=T.getUserInfo()||{}},v=({key:l})=>{d("switch-tab",l)},h=()=>{K.confirm({title:"确认退出",content:"您确定要退出登录吗？",okText:"确认退出",cancelText:"取消",okType:"danger",onOk(){T.clearToken(),T.clearUserInfo(),T.clearUserCode(),C.success("已安全退出"),x.push("/login")}})};return $(()=>{M()}),(l,a)=>{const c=o("a-menu-item"),r=o("a-menu"),s=o("a-avatar"),u=o("a-button"),y=o("a-menu-divider"),n=o("a-dropdown");return p(),z("div",Q,[t(r,{mode:"horizontal","selected-keys":[G.activeTab],onClick:v,class:"nav-menu"},{default:e(()=>[t(c,{key:"server"},{icon:e(()=>[t(k(S))]),default:e(()=>[a[0]||(a[0]=i(" Server管理 ",-1))]),_:1,__:[0]}),t(c,{key:"gpu"},{icon:e(()=>[t(k(A))]),default:e(()=>[a[1]||(a[1]=i(" GPU管理 ",-1))]),_:1,__:[1]})]),_:1},8,["selected-keys"]),w("div",W,[t(n,null,{overlay:e(()=>[t(r,null,{default:e(()=>[t(y),t(c,{key:"logout",onClick:h},{icon:e(()=>[t(k(q))]),default:e(()=>[a[2]||(a[2]=i(" 退出登录 ",-1))]),_:1,__:[2]})]),_:1})]),default:e(()=>[t(u,{type:"text",class:"user-info"},{default:e(()=>[t(s,{size:32,style:{"background-color":"#1890ff"}},{default:e(()=>{var m;return[i(f(((m=_.value.name)==null?void 0:m.charAt(0))||"A"),1)]}),_:1}),w("span",ee,f(_.value.name||"管理员"),1),t(k(R))]),_:1})]),_:1})])])}}},ae=j(te,[["__scopeId","data-v-4b6ac540"]]),oe={class:"page-content"},se={class:"page-header"},ne={key:1},le={style:{"font-weight":"500","margin-bottom":"4px"}},re={style:{"font-size":"12px",color:"#8c8c8c"}},ie={style:{"margin-left":"8px","font-size":"12px"}},ce={__name:"index",setup(G){const I=b([{title:"GPU ID",dataIndex:"gpuId",key:"gpuId",width:150},{title:"服务器",dataIndex:"server",key:"server",width:200},{title:"CPU 型号",dataIndex:"cpuModel",key:"cpuModel",width:150},{title:"状态",dataIndex:"status",key:"status",width:120},{title:"内存",dataIndex:"memory",key:"memory",width:150},{title:"存储",dataIndex:"storage",key:"storage",width:250}]),x=b([]),d=b(!1),_=async()=>{d.value=!0;try{await new Promise(s=>setTimeout(s,800));const a=await(await fetch("/mock/data.json")).json(),c=()=>`${Math.floor(Math.random()*201)+800}GB / 1024GB`,r=a.server_resources.map((s,u)=>({id:s.server.id,gpuId:s.gpu_id,name:s.server.name,cpuModel:s.cpu_model,status:s.status,memory:c(),storage:s.storage}));x.value=r,C.success("服务器数据更新成功")}catch(l){C.error("获取服务器数据失败"),console.error("服务器数据获取错误:",l)}finally{d.value=!1}},M=l=>({运行中:"green",维护中:"orange",离线:"red"})[l]||"default",v=l=>{const a=l.match(/(\d+)GB \/ (\d+)GB/);if(a){const c=parseInt(a[1]),r=parseInt(a[2]);return Math.min(c/r*100,100)}return 0},h=l=>l<50?"#52c41a":l<80?"#faad14":"#ff4d4f";return $(()=>{_()}),(l,a)=>{const c=o("a-typography-title"),r=o("a-typography-text"),s=o("a-col"),u=o("a-button"),y=o("a-row"),n=o("a-space"),m=o("a-tag"),g=o("a-progress"),V=o("a-table");return p(),z("div",oe,[w("div",se,[t(y,{justify:"space-between",align:"top"},{default:e(()=>[t(s,null,{default:e(()=>[t(c,{level:3},{default:e(()=>[t(k(S),{style:{"margin-right":"8px",color:"#1890ff"}}),a[0]||(a[0]=i(" Server资源管理 ",-1))]),_:1,__:[0]}),t(r,{type:"secondary"},{default:e(()=>a[1]||(a[1]=[i(" 监控和管理所有Server设备运行状态 ",-1)])),_:1,__:[1]})]),_:1}),t(s,null,{default:e(()=>[t(u,{type:"primary",loading:d.value,onClick:_,icon:B(k(N))},{default:e(()=>a[2]||(a[2]=[i(" 刷新数据 ",-1)])),_:1,__:[2]},8,["loading","icon"])]),_:1})]),_:1})]),t(V,{columns:I.value,"data-source":x.value,loading:d.value,pagination:!1,scroll:{x:1e3},class:"server-table"},{bodyCell:e(({column:P,record:D})=>[P.key==="gpuId"?(p(),U(n,{key:0},{default:e(()=>[t(k(S),{style:{color:"#1890ff"}}),w("span",null,f(D.gpuId),1)]),_:2},1024)):P.key==="server"?(p(),z("div",ne,[w("div",le,f(D.name),1),w("div",re,"ID: "+f(D.id),1)])):P.key==="status"?(p(),U(m,{key:2,color:M(D.status)},{default:e(()=>[i(f(D.status),1)]),_:2},1032,["color"])):P.key==="memory"?(p(),z(L,{key:3},[t(g,{percent:v(D.memory),"show-info":!1,size:"small","stroke-color":h(v(D.memory))},null,8,["percent","stroke-color"]),w("span",ie,f(D.memory),1)],64)):O("",!0)]),_:1},8,["columns","data-source","loading"])])}}},ue=j(ce,[["__scopeId","data-v-a7b0e231"]]),de={class:"page-content"},_e={class:"page-header"},pe={key:1,style:{"font-weight":"500"}},me={style:{"margin-left":"8px"}},fe={__name:"index",setup(G){const I=b([{title:"GPU",dataIndex:"index",key:"index",width:80},{title:"Name",dataIndex:"name",key:"name",width:250},{title:"Persistence-M",dataIndex:"persistence",key:"persistence",width:140},{title:"Bus-Id",dataIndex:"busId",key:"busId",width:180},{title:"Disp.A",dataIndex:"displayActive",key:"displayActive",width:100},{title:"Memory-Usage",dataIndex:"memoryUsage",key:"memoryUsage",width:180},{title:"GPU-Util",dataIndex:"gpuUtil",key:"gpuUtil",width:150},{title:"Compute M.",dataIndex:"computeMode",key:"computeMode",width:120},{title:"MIG M.",dataIndex:"migMode",key:"migMode",width:120}]),x=b([]),d=b(!1),_=async()=>{d.value=!0;try{await new Promise(a=>setTimeout(a,800));const l=(await(await fetch("/mock/data.json")).json()).gpu_resources.map(a=>({index:a.gpu_id,name:a.name,persistence:a.persistence_mode,busId:a.bus_id,displayActive:a.display_active,memoryUsage:a.memory_usage,gpuUtil:a.gpu_utilization,computeMode:a.compute_mode,migMode:a.mig_mode}));x.value=l,C.success("GPU数据更新成功")}catch(v){C.error("获取GPU数据失败"),console.error("GPU数据获取错误:",v)}finally{d.value=!1}},M=v=>v<30?"#52c41a":v<70?"#faad14":"#ff4d4f";return $(()=>{_()}),(v,h)=>{const l=o("a-typography-title"),a=o("a-typography-text"),c=o("a-col"),r=o("a-button"),s=o("a-row"),u=o("a-tag"),y=o("a-progress"),n=o("a-table");return p(),z("div",de,[w("div",_e,[t(s,{justify:"space-between",align:"top"},{default:e(()=>[t(c,null,{default:e(()=>[t(l,{level:3},{default:e(()=>[t(k(A),{style:{"margin-right":"8px",color:"#722ed1"}}),h[0]||(h[0]=i(" GPU资源管理 ",-1))]),_:1,__:[0]}),t(a,{type:"secondary"},{default:e(()=>h[1]||(h[1]=[i(" 监控和管理所有GPU设备运行状态 ",-1)])),_:1,__:[1]})]),_:1}),t(c,null,{default:e(()=>[t(r,{type:"primary",loading:d.value,onClick:_,icon:B(k(N))},{default:e(()=>h[2]||(h[2]=[i(" 刷新数据 ",-1)])),_:1,__:[2]},8,["loading","icon"])]),_:1})]),_:1})]),t(n,{columns:I.value,"data-source":x.value,loading:d.value,pagination:!1,scroll:{x:1500},class:"gpu-table"},{bodyCell:e(({column:m,record:g})=>[m.key==="index"?(p(),U(u,{key:0,color:"purple"},{default:e(()=>[i(f(g.index),1)]),_:2},1024)):m.key==="name"?(p(),z("div",pe,f(g.name),1)):m.key==="busId"?(p(),U(a,{key:2,code:""},{default:e(()=>[i(f(g.busId),1)]),_:2},1024)):m.key==="gpuUtil"?(p(),z(L,{key:3},[t(y,{percent:parseInt(g.gpuUtil),"show-info":!1,size:"small","stroke-color":M(parseInt(g.gpuUtil))},null,8,["percent","stroke-color"]),w("span",me,f(g.gpuUtil),1)],64)):m.key==="persistence"?(p(),U(u,{key:4,color:g.persistence==="On"?"green":"red"},{default:e(()=>[i(f(g.persistence),1)]),_:2},1032,["color"])):m.key==="displayActive"?(p(),U(u,{key:5,color:g.displayActive==="off"?"default":"blue"},{default:e(()=>[i(f(g.displayActive),1)]),_:2},1032,["color"])):m.key==="memoryUsage"?(p(),U(a,{key:6,type:"secondary"},{default:e(()=>[i(f(g.memoryUsage),1)]),_:2},1024)):O("",!0)]),_:1},8,["columns","data-source","loading"])])}}},ge=j(fe,[["__scopeId","data-v-f9e21ca0"]]),ye={class:"home-container"},ve={class:"content-area"},he={__name:"index",setup(G){const I=b("server"),x=b(!1),d=b({total:0,running:0,maintenance:0,offline:0}),_=b({total:0,active:0,avgUtilization:0,highUtilization:0}),M=b({performance:"A+",uptime:"99.9%",lastUpdate:"刚刚"}),v=F(()=>I.value==="server"?ue:ge),h=c=>{I.value!==c&&(x.value=!0,setTimeout(()=>{I.value=c,a(),x.value=!1},200))},l=async()=>{try{const r=await(await fetch("/mock/data.json")).json(),s=r.server_resources;d.value.total=s.length,d.value.running=s.filter(n=>n.status==="运行中").length,d.value.maintenance=s.filter(n=>n.status==="维护中").length,d.value.offline=s.filter(n=>n.status==="离线").length;const u=r.gpu_resources;_.value.total=u.length,_.value.active=u.filter(n=>n.persistence_mode==="On").length;const y=u.map(n=>parseInt(n.gpu_utilization));_.value.avgUtilization=Math.round(y.reduce((n,m)=>n+m,0)/y.length),_.value.highUtilization=u.filter(n=>parseInt(n.gpu_utilization)>70).length,M.value.lastUpdate="刚刚"}catch(c){console.error("计算统计数据失败:",c)}},a=()=>{l()};return Y("globalLoading",x),$(()=>{l(),console.log("Home page mounted - Data loaded from JSON")}),(c,r)=>{const s=o("a-tag"),u=o("a-statistic"),y=o("a-card"),n=o("a-col"),m=o("a-row"),g=o("a-spin");return p(),z("div",ye,[t(ae,{"active-tab":I.value,onSwitchTab:h},null,8,["active-tab"]),w("div",ve,[t(m,{gutter:[16,16],class:"stats-section"},{default:e(()=>[t(n,{xs:24,sm:12,md:6},{default:e(()=>[t(y,{class:"stat-card"},{default:e(()=>[t(u,{title:"服务器总数",value:d.value.total,"value-style":{color:"#1890ff"}},{prefix:e(()=>[t(k(S))]),suffix:e(()=>[t(s,{color:"green"},{default:e(()=>[i(f(d.value.running)+" 运行中",1)]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),t(n,{xs:24,sm:12,md:6},{default:e(()=>[t(y,{class:"stat-card"},{default:e(()=>[t(u,{title:"GPU总数",value:_.value.total,"value-style":{color:"#722ed1"}},{prefix:e(()=>[t(k(A))]),suffix:e(()=>[t(s,{color:"blue"},{default:e(()=>[i(f(_.value.active)+" 活跃",1)]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),t(n,{xs:24,sm:12,md:6},{default:e(()=>[t(y,{class:"stat-card"},{default:e(()=>[t(u,{title:"平均利用率",value:_.value.avgUtilization,suffix:"%","value-style":{color:"#52c41a"}},{prefix:e(()=>[t(k(X))]),suffix:e(()=>[t(s,{color:"default"},{default:e(()=>r[0]||(r[0]=[i("实时监控",-1)])),_:1,__:[0]})]),_:1},8,["value"])]),_:1})]),_:1}),t(n,{xs:24,sm:12,md:6},{default:e(()=>[t(y,{class:"stat-card"},{default:e(()=>[t(u,{title:"系统性能",value:M.value.performance,"value-style":{color:"#fa8c16"}},{prefix:e(()=>[t(k(E))]),suffix:e(()=>[t(s,{color:"green"},{default:e(()=>r[1]||(r[1]=[i("优秀",-1)])),_:1,__:[1]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(y,{class:"page-container"},{default:e(()=>[t(H,{name:"page-fade",mode:"out-in"},{default:e(()=>[(p(),U(J(v.value),{key:I.value}))]),_:1})]),_:1})]),x.value?(p(),U(g,{key:0,class:"global-loading",size:"large"},{default:e(()=>r[2]||(r[2]=[w("div",{class:"loading-content"},[w("div",{class:"loading-text"},"正在切换页面...")],-1)])),_:1,__:[2]})):O("",!0)])}}},De=j(he,[["__scopeId","data-v-27612610"]]);export{De as default};

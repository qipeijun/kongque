import{r as b,B as S,aY as D,l as m,q as e,aZ as w,p as t,k as s,X as i,v as h,a_ as G,a$ as j,b0 as g,a1 as L,b1 as V,z as O,aX as N,j as z,b2 as A,F as R,d as q,b3 as F,b4 as X,M as E,b5 as H,y as J}from"./@ant-design/icons-vue-SdefuLng-20250921152813.js";import{u as T,a as Y,M as Z,b as P}from"./index-Bv5GEEU7-20250921152813.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U-20250921152813.js";import"./dayjs-B73STPP_-20250921152813.js";import"./lodash-C9rdhAyu-20250921152813.js";import"./perfect-scrollbar-BdXks_5i-20250921152813.js";import"./pinia-Ca6Pv-Vt-20250921152813.js";const K={class:"top-nav"},Q={class:"user-section"},W={class:"username"},ee={__name:"index",props:{activeTab:{type:String,required:!0}},emits:["switch-tab"],setup($,{emit:M}){const k=Y(),c=M,_=b({}),U=()=>{_.value=T.getUserInfo()||{}},x=({key:r})=>{c("switch-tab",r)},f=()=>{Z.confirm({title:"确认退出",content:"您确定要退出登录吗？",okText:"确认退出",cancelText:"取消",okType:"danger",onOk(){T.clearToken(),T.clearUserInfo(),T.clearUserCode(),P.success("已安全退出"),k.push("/login")}})};return S(()=>{U()}),(r,l)=>{const o=s("a-menu-item"),a=s("a-menu"),u=s("a-avatar"),d=s("a-button"),p=s("a-menu-divider"),n=s("a-dropdown");return m(),D("div",K,[e(a,{mode:"horizontal","selected-keys":[$.activeTab],onClick:x,class:"nav-menu"},{default:t(()=>[e(o,{key:"server"},{icon:t(()=>[e(h(G))]),default:t(()=>[l[0]||(l[0]=i(" Server管理 ",-1))]),_:1,__:[0]}),e(o,{key:"gpu"},{icon:t(()=>[e(h(j))]),default:t(()=>[l[1]||(l[1]=i(" GPU管理 ",-1))]),_:1,__:[1]})]),_:1},8,["selected-keys"]),w("div",Q,[e(n,null,{overlay:t(()=>[e(a,null,{default:t(()=>[e(p),e(o,{key:"logout",onClick:f},{icon:t(()=>[e(h(V))]),default:t(()=>[l[2]||(l[2]=i(" 退出登录 ",-1))]),_:1,__:[2]})]),_:1})]),default:t(()=>[e(d,{type:"text",class:"user-info"},{default:t(()=>[e(u,{size:32,style:{"background-color":"#1890ff"}},{default:t(()=>{var y;return[i(g(((y=_.value.name)==null?void 0:y.charAt(0))||"A"),1)]}),_:1}),w("span",W,g(_.value.name||"管理员"),1),e(h(L))]),_:1})]),_:1})])])}}},te=B(ee,[["__scopeId","data-v-4b6ac540"]]),ae={class:"page-content"},oe={class:"page-header"},se={key:1},ne={style:{"font-weight":"500","margin-bottom":"4px"}},le={style:{"font-size":"12px",color:"#8c8c8c"}},re={__name:"index",setup($){const M=b([{title:"GPU ID",dataIndex:"gpuId",key:"gpuId",width:150},{title:"服务器",dataIndex:"server",key:"server",width:200},{title:"CPU 型号",dataIndex:"cpuModel",key:"cpuModel",width:150},{title:"状态",dataIndex:"status",key:"status",width:120},{title:"内存",dataIndex:"memory",key:"memory",width:150},{title:"存储",dataIndex:"storage",key:"storage",width:250}]),k=b([]),c=b(!1),_=async()=>{c.value=!0;try{await new Promise(o=>setTimeout(o,800));const f=await(await fetch("/mock/data.json")).json(),r=()=>`${Math.floor(Math.random()*201)+800}GB / 1024GB`,l=f.server_resources.map((o,a)=>({id:o.server.id,gpuId:o.gpu_id,name:o.server.name,cpuModel:o.cpu_model,status:o.status,memory:o.memory,storage:o.storage}));k.value=l,P.success("服务器数据更新成功")}catch(x){P.error("获取服务器数据失败"),console.error("服务器数据获取错误:",x)}finally{c.value=!1}},U=x=>({运行中:"green",维护中:"orange",离线:"red"})[x]||"default";return S(()=>{_()}),(x,f)=>{const r=s("a-typography-title"),l=s("a-typography-text"),o=s("a-col"),a=s("a-button"),u=s("a-row"),d=s("a-space"),p=s("a-tag"),n=s("a-table");return m(),D("div",ae,[w("div",oe,[e(u,{justify:"space-between",align:"top"},{default:t(()=>[e(o,null,{default:t(()=>[e(r,{level:3},{default:t(()=>[e(h(G),{style:{"margin-right":"8px",color:"#1890ff"}}),f[0]||(f[0]=i(" Server资源管理 ",-1))]),_:1,__:[0]}),e(l,{type:"secondary"},{default:t(()=>f[1]||(f[1]=[i(" 监控和管理所有Server设备运行状态 ",-1)])),_:1,__:[1]})]),_:1}),e(o,null,{default:t(()=>[e(a,{type:"primary",loading:c.value,onClick:_,icon:O(h(N))},{default:t(()=>f[2]||(f[2]=[i(" 刷新数据 ",-1)])),_:1,__:[2]},8,["loading","icon"])]),_:1})]),_:1})]),e(n,{columns:M.value,"data-source":k.value,loading:c.value,pagination:!1,scroll:{x:1e3},class:"server-table"},{bodyCell:t(({column:y,record:I})=>[y.key==="gpuId"?(m(),z(d,{key:0},{default:t(()=>[e(h(G),{style:{color:"#1890ff"}}),w("span",null,g(I.gpuId),1)]),_:2},1024)):y.key==="server"?(m(),D("div",se,[w("div",ne,g(I.name),1),w("div",le,"ID: "+g(I.id),1)])):y.key==="status"?(m(),z(p,{key:2,color:U(I.status)},{default:t(()=>[i(g(I.status),1)]),_:2},1032,["color"])):A("",!0)]),_:1},8,["columns","data-source","loading"])])}}},ie=B(re,[["__scopeId","data-v-586778d1"]]),ce={class:"page-content"},ue={class:"page-header"},de={key:1,style:{"font-weight":"500"}},_e={style:{"margin-left":"8px"}},pe={key:6},me={style:{"margin-left":"8px","font-size":"12px"}},fe={__name:"index",setup($){const M=b([{title:"GPU",dataIndex:"index",key:"index",width:80},{title:"Name",dataIndex:"name",key:"name",width:250},{title:"Persistence-M",dataIndex:"persistence",key:"persistence",width:140},{title:"Bus-Id",dataIndex:"busId",key:"busId",width:180},{title:"Disp.A",dataIndex:"displayActive",key:"displayActive",width:100},{title:"Memory-Usage",dataIndex:"memoryUsage",key:"memoryUsage",width:180},{title:"GPU-Util",dataIndex:"gpuUtil",key:"gpuUtil",width:150},{title:"Compute M.",dataIndex:"computeMode",key:"computeMode",width:120},{title:"MIG M.",dataIndex:"migMode",key:"migMode",width:120}]),k=b([]),c=b(!1),_=async()=>{c.value=!0;try{await new Promise(a=>setTimeout(a,800));const o=(await(await fetch("/mock/data.json")).json()).gpu_resources.map(a=>{const u=Math.random()*20+10,d=81920,p=Math.floor(d*u/100);return{index:a.gpu_id,name:a.name,persistence:a.persistence_mode,busId:a.bus_id,displayActive:a.display_active,memoryUsage:`${p}MB / ${d}MB`,gpuUtil:a.gpu_utilization,computeMode:a.compute_mode,migMode:a.mig_mode}});k.value=o,P.success("GPU数据更新成功")}catch(r){P.error("获取GPU数据失败"),console.error("GPU数据获取错误:",r)}finally{c.value=!1}},U=r=>r<30?"#52c41a":r<70?"#faad14":"#ff4d4f",x=r=>{const l=r.match(/(\d+)MB \/ (\d+)MB/);if(l){const o=parseInt(l[1]),a=parseInt(l[2]);return Math.round(o/a*100)}return 0},f=r=>r<=30?"#52c41a":r<=50?"#faad14":"#ff4d4f";return S(()=>{_()}),(r,l)=>{const o=s("a-typography-title"),a=s("a-typography-text"),u=s("a-col"),d=s("a-button"),p=s("a-row"),n=s("a-tag"),y=s("a-progress"),I=s("a-table");return m(),D("div",ce,[w("div",ue,[e(p,{justify:"space-between",align:"top"},{default:t(()=>[e(u,null,{default:t(()=>[e(o,{level:3},{default:t(()=>[e(h(j),{style:{"margin-right":"8px",color:"#722ed1"}}),l[0]||(l[0]=i(" GPU资源管理 ",-1))]),_:1,__:[0]}),e(a,{type:"secondary"},{default:t(()=>l[1]||(l[1]=[i(" 监控和管理所有GPU设备运行状态 ",-1)])),_:1,__:[1]})]),_:1}),e(u,null,{default:t(()=>[e(d,{type:"primary",loading:c.value,onClick:_,icon:O(h(N))},{default:t(()=>l[2]||(l[2]=[i(" 刷新数据 ",-1)])),_:1,__:[2]},8,["loading","icon"])]),_:1})]),_:1})]),e(I,{columns:M.value,"data-source":k.value,loading:c.value,pagination:!1,scroll:{x:1500},class:"gpu-table"},{bodyCell:t(({column:C,record:v})=>[C.key==="index"?(m(),z(n,{key:0,color:"purple"},{default:t(()=>[i(g(v.index),1)]),_:2},1024)):C.key==="name"?(m(),D("div",de,g(v.name),1)):C.key==="busId"?(m(),z(a,{key:2,code:""},{default:t(()=>[i(g(v.busId),1)]),_:2},1024)):C.key==="gpuUtil"?(m(),D(R,{key:3},[e(y,{percent:parseInt(v.gpuUtil),"show-info":!1,size:"small","stroke-color":U(parseInt(v.gpuUtil))},null,8,["percent","stroke-color"]),w("span",_e,g(v.gpuUtil),1)],64)):C.key==="persistence"?(m(),z(n,{key:4,color:v.persistence==="On"?"green":"red"},{default:t(()=>[i(g(v.persistence),1)]),_:2},1032,["color"])):C.key==="displayActive"?(m(),z(n,{key:5,color:v.displayActive==="off"?"default":"blue"},{default:t(()=>[i(g(v.displayActive),1)]),_:2},1032,["color"])):C.key==="memoryUsage"?(m(),D("div",pe,[e(y,{percent:x(v.memoryUsage),"show-info":!1,size:"small","stroke-color":f(x(v.memoryUsage))},null,8,["percent","stroke-color"]),w("span",me,g(v.memoryUsage),1)])):A("",!0)]),_:1},8,["columns","data-source","loading"])])}}},ge=B(fe,[["__scopeId","data-v-9a58d27a"]]),ye={class:"home-container"},ve={class:"content-area"},he={__name:"index",setup($){const M=b("server"),k=b(!1),c=b({total:0,running:0,maintenance:0,offline:0}),_=b({total:0,active:0,avgUtilization:0,highUtilization:0}),U=b({performance:"A+",uptime:"99.9%",lastUpdate:"刚刚"}),x=q(()=>M.value==="server"?ie:ge),f=o=>{M.value!==o&&(k.value=!0,setTimeout(()=>{M.value=o,l(),k.value=!1},200))},r=async()=>{try{const a=await(await fetch("/mock/data.json")).json(),u=a.server_resources;c.value.total=u.length,c.value.running=u.filter(n=>n.status==="运行中").length,c.value.maintenance=u.filter(n=>n.status==="维护中").length,c.value.offline=u.filter(n=>n.status==="离线").length;const d=a.gpu_resources;_.value.total=d.length,_.value.active=d.filter(n=>n.persistence_mode==="On").length;const p=d.map(n=>parseInt(n.gpu_utilization));_.value.avgUtilization=Math.round(p.reduce((n,y)=>n+y,0)/p.length),_.value.highUtilization=d.filter(n=>parseInt(n.gpu_utilization)>70).length,U.value.lastUpdate="刚刚"}catch(o){console.error("计算统计数据失败:",o)}},l=()=>{r()};return J("globalLoading",k),S(()=>{r(),console.log("Home page mounted - Data loaded from JSON")}),(o,a)=>{const u=s("a-tag"),d=s("a-statistic"),p=s("a-card"),n=s("a-col"),y=s("a-row"),I=s("a-spin");return m(),D("div",ye,[e(te,{"active-tab":M.value,onSwitchTab:f},null,8,["active-tab"]),w("div",ve,[e(y,{gutter:[16,16],class:"stats-section"},{default:t(()=>[e(n,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{class:"stat-card"},{default:t(()=>[e(d,{title:"服务器总数",value:c.value.total,"value-style":{color:"#1890ff"}},{prefix:t(()=>[e(h(G))]),suffix:t(()=>[e(u,{color:"green"},{default:t(()=>[i(g(c.value.running)+" 运行中",1)]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(n,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{class:"stat-card"},{default:t(()=>[e(d,{title:"GPU总数",value:_.value.total,"value-style":{color:"#722ed1"}},{prefix:t(()=>[e(h(j))]),suffix:t(()=>[e(u,{color:"blue"},{default:t(()=>[i(g(_.value.active)+" 活跃",1)]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(n,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{class:"stat-card"},{default:t(()=>[e(d,{title:"平均利用率",value:_.value.avgUtilization,suffix:"%","value-style":{color:"#52c41a"}},{prefix:t(()=>[e(h(F))]),suffix:t(()=>[e(u,{color:"default"},{default:t(()=>a[0]||(a[0]=[i("实时监控",-1)])),_:1,__:[0]})]),_:1},8,["value"])]),_:1})]),_:1}),e(n,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{class:"stat-card"},{default:t(()=>[e(d,{title:"系统性能",value:U.value.performance,"value-style":{color:"#fa8c16"}},{prefix:t(()=>[e(h(X))]),suffix:t(()=>[e(u,{color:"green"},{default:t(()=>a[1]||(a[1]=[i("优秀",-1)])),_:1,__:[1]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(p,{class:"page-container"},{default:t(()=>[e(E,{name:"page-fade",mode:"out-in"},{default:t(()=>[(m(),z(H(x.value),{key:M.value}))]),_:1})]),_:1})]),k.value?(m(),z(I,{key:0,class:"global-loading",size:"large"},{default:t(()=>a[2]||(a[2]=[w("div",{class:"loading-content"},[w("div",{class:"loading-text"},"正在切换页面...")],-1)])),_:1,__:[2]})):A("",!0)])}}},De=B(he,[["__scopeId","data-v-27612610"]]);export{De as default};
